=pod

=encoding utf8

=head1 Catan Game Notation

This document defines a notation for the game Settlers of Catan, called "Catan Game Notation" (CGN). CGN is represented as JSON and is designed to capture "what happened" for a game of Catan using the base game.

This is alpha stage and is untested. Feedback welcome!

=head2 Log

A log of CGN captures the entirety of a game of Catan from setup to end. The log is an array of objects that contain notation describing what happened.

=head2 Tile Locations

All tiles are numbered (including sea tiles), using the axial (trapezoidal) coordinate system:

             0,-3  1,-3  2,-3   3,-3
         -1,-2  0,-2  1,-2   2,-2   3,-2
     -2,-1  -1,-1  0,-1   1,-1   2,-1   3,-1
  -3,0   -2,0   -1,0    0,0    1,0    2,0    3,0
     -3,1   -2,1   -1,1   0,1    1,1    2,1
        -3,2   -2,2   -1,2  0,2    1,2
           -3,3   -2,3   -1,3  0,3

This is the same map with the sea tiles represented by tildes (incorrect notation but easier to interpret visually):

           ~~~~  ~~~~  ~~~~   ~~~~
        ~~~~ 0,-2   1,-2   2,-2  ~~~~
     ~~~~  -1,-1  0,-1  1,-1  2,-1  ~~~~
  ~~~~  -2,0   -1,0   0,0   1,0   2,0  ~~~~
     ~~~~  -2,1   -1,1   0,1   1,1  ~~~~
        ~~~~  -2,2   -1,2   0,2  ~~~~
           ~~~~   ~~~~   ~~~~  ~~~~

=head2 Tile Types

A tile can be any one of the below

  H   Hills
  D   Desert
  HR  Harbor Generic
  HR_ Harbor Specific: B, G, L, O, W
  M   Mountains
  S   Sea
  F   Fields
  FO  Forest
  P   Pasture

=head2 Resource Number

A tile can have one resource number on it, valid numbers are between 2-6 and 8-12. There is also a limit on the frequency of resource numbers. These are all the avialable resource numbers for a basic game:

  2,3,3,4,4,5,5,6,6,8,8,9,9,10,10,11,11,12

=head2 Tile Notation

Tile notation is used to define the playing map. Every tile is listed with its coordinates, type and resource number. C<null> represents no resource number. The starter map layout:

  [
    [0,-3,"HR",null],
    [1,-3,"S",null],
    [2,-3,"HRG",null],
    [3,-3,"S",null],
    [3,-2,"HRO",null],
    [3,-1,"S",null],
    [3,0,"HR",null],
    [2,1,"S",null],
    [1,2,"HR",null],
    [0,3,"S",null],
    [-1,3,"HRW",null],
    [-2,3,"S",null],
    [-3,3,"HR",null],
    [-3,2,"S",null],
    [-3,1,"HRB",null],
    [-3,0,"S",null],
    [-2,-1,"HRL",null],
    [-1,-2,"S",null],
    [0,-2,"M",10],
    [1,-2,"P",2],
    [2,-2,"FO",9],
    [2,-1,"H",10],
    [2,0,"M",8],
    [1,1,"P",5],
    [0,2,"P",11],
    [-1,2,"F",6],
    [-2,2,"H",5],
    [-2,1,"FO",8],
    [-2,0,"F",9],
    [-1,-1,"F",12],
    [0,-1,"H",6],
    [1,-1,"P",4],
    [1,0,"FO",3],
    [0,1,"F",4],
    [-1,1,"O",3],
    [-1,0,"FO",11],
    [0,0,"D",null]
  ]

=head2 Intersections

Intersections represent a point between 3 tile locations in a clockwise order. Intersections are represented as an array of 3 tile locations. E.g. the six intersections of the center desert tile on the starter map layout:

                 [[0,-1],[0,0],[-1,0]]
                         /   \
  [[0,-1],[0,0],[-1,0]] /     \  [[1,-1],[1,0],[0,0]]
                       |  0,0  |
                       |       |
  [[0,0],[-1,1],[-1,0]] \     /  [[1,0],[0,1],[0,0]]
                         \   /
                 [[0,1],[-1,1],[0,0]]


=head2 Paths

Paths are lines between contiguous intersections and are represented as an array of intersections. Each path must have at least two intersections:

  [ [[0,0],[-1,1],[-1,0]], [[0,1],[-1,1],[0,0]] ]

=head2 Resources

There are 5 types of resources:

  B  Brick
  G  Grain
  L  Lumber
  O  Ore
  W  Wool

=head2 Assets

Players may accumulate these throughout the game. There are four normal and two
special types:

  Code  Name              How to get it
  ==========================================
  DC    Development card  Build action
  S     Settlement        Build action
  C     City              Build action
  R     Road              Build action
  LA    Largest army      Largest Army event
  LR    Longest road      Longest Road event

There are 5 types of development cards:

  KN  Knight
  MO  Monopoly
  RB  Road building
  VP  Victory Point
  YP  Year of plenty

=head2 Events

Events are the things which drive the game: player actions, dice rolls etc.

  Code Name                     Detail
  ===================================================
  PA   Player Add               player #
  PR   Player Remove
  MD   Map Define
  PS   Phase Start              Setup|Deployment|Play
  PE   Phase End                Setup|Deployment|Play
  RS   Round Start              round #
  RE   Round End                round #
  RP   Resource Production      A&R Notation
  R!   Robber!
  TS   Turn Start               player #
  TE   Turn End                 player #
  SP   Set player order         ["P3","P4","P1","P2"]
  LA   Largest army             player #
  LR   Longest road             player #
  CH   Chat                     player #, text
  GO   Game Over                winning player #
  O    Offer trade              UUID, A&R Notation
  W    Withdraw offer           UUID
  A    Accept trade             UUID
  B    Build asset              A&R Notation
  R    Roll dice                "P1":#
  C    Concede resource         A&R Notation
  D    Deploy asset             Asset code, location
  T    Trade resources          A&R Notation
  P    Play development card    Card type (KN|MO|RB|VP|YP)
  S    Steal resources          A&R Notation
  M    Move robber              Tile Location (#)
  Q    Quit game                Player name

In JSON the code and the detail sections are provided:

  [ "PS": "Setup",
    "MD": { ... }
  ]

=head2 Trading

Trading is a big part of Catan. Trades have two parts: offer and acceptance.
A Player may offer a trade to other players using A&R Notation.

The trade offer can be ended in four ways:

=over 4

=item * Withdraw offer

The offering player cancels the offer using the Withdraw offer action.

=item * Acceptance

A player accepts the offer. The first player to do this wins the trade and the
goods should be exchanged using the Trade resources action.

=item * Offer a new trade

The offering player can offer a new trade, this autommatically cancels any
existing trade offer they had made.

=item * End turn

If a player's turn ends, all offers are cancelled.

=back

Here is an example trade between player 1 and player 2:

  "O":{"P1":{"B":-2,"W":1},"P2":{"B":2,"W":-1}, "UUID":"1234-56789-01234"},
  "A":{"P2":{"UUID":"1234-56789-01234"}},
  "T":{"P1":{"B":-2,"W":1},"P3":{"B":2,"W":-1}, "UUID":"1234-56789-01234"},

The exchange begins with a Trade offer from player 1 for 1 wool in exchange for
2 brick to player 2. Player 2 accepts the offer, and this triggers the Trade
action.

Trades can be offered to more than one person at time, here the same offer is
provided to players 2 and 4:

  "O":{"P1":{"B":-2,"W":1},
       "?":{"P2":{"B":2,"W":-1},
            "P4":{"B":2,"W":-1}},
       "UUID":"1234-56789-01234"
      },

Because A&R notation has to balance, we represent the "other side" of the trade
with the unknown player C<?>. This is a key to a dictionary of player names
and the details of the offer. This makes it possible to offer a single trade to
one or more players at a time.

=head2 Asset and Resources Notation (A&R Notation)

A&R Notation records which assets or resources and in what quantity are being
traded by players with the bank or with each other.

A&R uses the asset or resource code as the key and the value as the quantity.
Both quantities gained and lost are listed. So a trade between player 1 and
player 2 for 2 lumber for a wool looks like:

  {
    "P1":{"L":-2,"W":1},
    "P2":{"L":2,"W":-1 }
  }

The implication of this notation is that all resources must balance. For trades
with the bank, C<B> represents the bank:

  {
    "P1":{"G":-4,"B":1},
    "B":{"G":4,"B":-1}
  }

A&R Notation isn't just for trades. It's used for gains from resource
production, stealing resources with the robber, conceding resources back to the
bank and building. For example if player 3 wanted to build a road with 1 brick
and 1 lumber:

  {
    "P3":{"R":1,"B":-1,"L":-1},
    "B":{"R":-1,"B":1,"L":1}
  }

=head2 Comments and Chat

Comments can be added with the C<#> symbol:

  # "This is a comment"

Player chat uses the event code C<CH>. It provides a key/pair of the player
name and the chat text. Here's a conversation:

  CH {"P1":"Let's do this!"},
  CH {"P2":"You're going to lose again!"}

Comments and chat are not necessary for game notation, but may help with the
implementation of a Catan server using game notation.

=head2 Phases

=over 4

=item 1 Setup

Setup involves the events add player and define map. This is an example setup
for a 4 player game:

  PS "Setup"
  PA "P1"
  PA "P2"
  PA "P3"
  PA "P4"
  MD { (Tile notation) }
  PE "Setup"

=item 2 Deployment

Players can deploy settlements and roads in the deployment phase. Settlements
must be placed on an unoccupied intersection with no settlement on an adjacent
intersection. Roads must be placed on lines with one end on the player's
settlement. Each player gains 2 settlements, 2 roads and resources depending
on their second settlement placement.

  PS "Deployment"
  T  {"P1":{"S":2,"R":2},
      "P2":{"S":2,"R":2},
      "P3":{"S":2,"R":2},
      "P4":{"S":2,"R":2},
      "B":{"S":-8,"R":-8}},
  R  {"P1":3, "P2":5, "P3":11, "P4":8}
  SP ["P3","P4","P1","P2"]
  D  {"P3": {"S":[20 31 19],"R":[[20 31 19], [20 31 31]]} }
  ...
  PE "Deployment"

=item 3 Play

TBC

=back

=head2 Example

See the file F<example.json> for an example of CGN notation. It is not yet
finished!

=head1 FAQ

=over 4

=item *

I<Is CGN case-sensitive>? No.

=back

=head2 Author

David Farrell, E<copy> 2015.

=head2 License

FreeBSD, see LICENSE

=cut
