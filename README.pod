=pod

=encoding utf8

=head1 Settlers Game Notation

This document defines a notation for the game island colonization game Settlers, called "Settlers Game Notation" (SGN). SGN is represented as JSON and is designed to capture "what happened" for a game of Settlers using the base game.

=head2 Log

A log of SGN captures the entirety of a game of Settlers from setup to end. The log is an array of Messages (see next section) that contain notation describing what happened. See F<example.json> for an entire game log.

=head2 Messages

Every event in a game of Settlers is described in a message format. A message is a JSON object with the following attributes:

  Name    Value
  ----------------------------------------------------------------------------
  uuid    universal unique identifier, used to identify individual game events
  player  The player # (or "A" for admin if it came from the server)
  event   The two letter event code (see Events below)
  value   The value associated with the event code (see Events below)

An example admin message for declaring player 2 has joined the game:

  {
    "uuid": "1C68D574-937F-11E5-AF19-C9E87C9D2E84",
    "player": "A",
    "event": "PA",
    "value": {"player": "2"},
  }

=head2 Tiles

All tiles are numbered (including sea tiles), using the axial (trapezoidal) coordinate system:

             0,-3  1,-3  2,-3   3,-3
         -1,-2  0,-2  1,-2   2,-2   3,-2
     -2,-1  -1,-1  0,-1   1,-1   2,-1   3,-1
  -3,0   -2,0   -1,0    0,0    1,0    2,0    3,0
     -3,1   -2,1   -1,1   0,1    1,1    2,1
        -3,2   -2,2   -1,2  0,2    1,2
           -3,3   -2,3   -1,3  0,3

This is the same map with the sea tiles represented by tildes (incorrect notation but easier to interpret visually):

           ~~~~  ~~~~  ~~~~   ~~~~
        ~~~~ 0,-2   1,-2   2,-2  ~~~~
     ~~~~  -1,-1  0,-1  1,-1  2,-1  ~~~~
  ~~~~  -2,0   -1,0   0,0   1,0   2,0  ~~~~
     ~~~~  -2,1   -1,1   0,1   1,1  ~~~~
        ~~~~  -2,2   -1,2   0,2  ~~~~
           ~~~~   ~~~~   ~~~~  ~~~~

Tile notation is used to define the layout of the board tiles and the location of the robber.

=head2 Tile Types

A tile can be any one of the below:

  H   Hills
  D   Desert
  M   Mountains
  S   Sea
  F   Fields
  FO  Forest
  P   Pastures

=head2 Resource Number

A tile can have one resource number on it, valid numbers are between 2-6 and 8-12. There is also a limit on the frequency of resource numbers. These are all the available resource numbers for a basic game:

  2,3,3,4,4,5,5,6,6,8,8,9,9,10,10,11,11,12

=head2 Intersections

Intersections represent a point between 3 tile locations in a clockwise order. Intersections are represented as an array of 3 tile locations. E.g. the six intersections of the center tile on the starter map layout:

                 [[0,-1],[0,0],[-1,0]]
                         /   \
  [[0,-1],[0,0],[-1,0]] /     \  [[1,-1],[1,0],[0,0]]
                       |  0,0  |
                       |       |
  [[0,0],[-1,1],[-1,0]] \     /  [[1,0],[0,1],[0,0]]
                         \   /
                 [[0,1],[-1,1],[0,0]]


Intersections are used to define the location of settlements and cities.

=head2 Paths

Paths are lines between contiguous intersections and are represented as an array of intersections. Each path must have at least two intersections:

  [ [[0,0],[-1,1],[-1,0]], [[0,1],[-1,1],[0,0]] ]

Paths are used to define where harbors and roads are placed.

=head2 Harbors

Harbors are placed on paths adjacent to sea tiles. There are 6 harbor types:

  HR  - Generic Harbor
  HRB - Brick Harbor
  HRG - Grain Harbor
  HRL - Lumber Harbor
  HRO - Ore Harbor
  HRW - Wool Harbor

Typical maps will have 4 generic harbors and 1 of every other kind.

=head2 Defining the map

Every tile is listed with its coordinates, type and resource number. C<null> represents no resource number. Harbors are declared at path locations. A starter map layout:

  {
    "tiles": [
      [0,-3,"S",null],
      [1,-3,"S",null],
      [2,-3,"S",null],
      [3,-3,"S",null],
      [3,-2,"S",null],
      [3,-1,"S",null],
      [3,0,"S",null],
      [2,1,"S",null],
      [1,2,"S",null],
      [0,3,"S",null],
      [-1,3,"S",null],
      [-2,3,"S",null],
      [-3,3,"S",null],
      [-3,2,"S",null],
      [-3,1,"S",null],
      [-3,0,"S",null],
      [-2,-1,"S",null],
      [-1,-2,"S",null],
      [0,-2,"FO",11],
      [1,-2,"P",12],
      [2,-2,"F",9],
      [2,-1,"P",10],
      [2,0,"F",8],
      [1,1,"M",3],
      [0,2,"FO",6],
      [-1,2,"F",2],
      [-2,2,"M",5],
      [-2,1,"H",8],
      [-2,0,"D",null],
      [-1,-1,"H",4],
      [0,-1,"M",6],
      [1,-1,"H",5],
      [1,0,"FO",4],
      [0,1,"P",9],
      [-1,1,"P",10],
      [-1,0,"FO",3],
      [0,0,"F",11]
    ],
    "harbors": [
      [[[0,-3],[0,-2],[-1,-2]],  [[1,-3],[0,-2],[0,-3]]],   "HR"],
      [[[2,-3],[1,-2],[1,-3]],   [[2,-3],[2,-2],[1,-2]]],   "HRW"],
      [[[3,-2],[2,-1],[2,-2]],   [[3,-2],[3,-1],[2,-1]]],   "HR"],
      [[[3,-1],[3,0],[2,0]],     [[3,0],[2,1],[2,0]]],      "HR"],
      [[[2,1],[1,2],[1,1]],      [[1,1],[1,2],[0,2]]],      "HRB"],
      [[[0,2],[-1,3],[-1,2]],    [[-1,2],[-1,3],[-2,3]]],   "HRL"],
      [[[-2,2],[-2,3],[-3,3]],   [[-2,2],[-3,3],[-3,2]]],  "HR"],
      [[[-2,1],[-3,2],[-3,1]],   [[-2,0],[-2,1],[-3,1]]],   "HRG"],
      [[[-1,-1],[-2,0],[-2,-1]], [[-1,-2],[-1,-1],[-2,-1]]],"HRO"]
    ],
  }

=head2 Resources

There are 5 types of resources:

  Code  Type
  ------------
  B     Brick
  G     Grain
  L     Lumber
  O     Ore
  W     Wool

=head2 Resources notation

Resources notation records which resources and in what quantity are being traded by players with the bank or with each other.

It uses the resource code as the key and the value as the quantity. Both quantities gained and lost are listed. So a trade between player 1 and player 2 for 2 lumber for a wool looks like:

  {
    "1":{"L":-2,"W":1},
    "2":{"L":2,"W":-1 }
  }

The implication of this notation is that all resources must balance. For trades with the bank, C<bank> represents the bank:

  {
    "1":{"G":-4,"B":1},
    "bank":{"G":4,"B":-1}
  }

Resource notation isn't just for trades. It's used for gains from resource production, stealing resources with the robber and conceding resources back to the
bank.

=head2 Assets

Players may accumulate these throughout the game. There are four normal and two special types:

  Code  Name              How to get it
  ---------------------------------------------------------
  DC    Development card  Build development card event (BD)
  S     Settlement        Build settlement event (BS)
  C     City              Build city event (BC)
  R     Road              Build road event (BR)
  LA    Largest army      Largest Army event
  LR    Longest road      Longest Road event

There are 5 types of development cards:

  Type  Name
  -------------------
  KN    Knight
  MO    Monopoly
  RB    Road building
  VP    Victory Point
  YP    Year of plenty

=head2 Events

Events are the things which drive the game: player actions, dice rolls etc. Every entry in SGN is an event, consisting of an event code and a JSON value. Refer to F<example.json> for examples of these events in SGN.

  Code Name                    Value
  ==================================================
  BC   Build city              {"player": "#", "intersection":<intersection coordinates>}
  BD   Build development card  {"player": "#", "type": "KN|MO|RB|VP|YP"}
  BR   Build road              {"player": "#", "path":<path coordinates>}
  BS   Build settlement        {"player": "#", "intersection":<intersection coordinates>}
  CH   Chat                    {"player": "#", "msg": "msg text"}
  CR   Concede resources       {"player": "#", "resources":<resource notation>}
  DR   Dice roll               {"player": "#", "result":#}
  GO   Game Over               {"player": "#"}
  LA   Largest army            {"player": "#", "strength":#}
  LR   Longest road            {"player": "#"}, "length":#}
  MD   Map Define              {"tiles":[...], "harbors":[..]}
  MO   Monopoly                {"player": "#", "resources":<resource notation>}
  PA   Player Add              {"player": "#"}
  PD   Play development card   {"player": "#", "type": "KN|MO|RB|VP|YP"}
  PE   Phase End               {"phase": "Setup|Deployment|Play|End"}
  PS   Phase Start             {"phase": "Setup|Deployment|Play|End"}
  RA   Robber activate         null
  RD   Robber deactivate       null
  RE   Round End               {"round": #}
  RM   Robber move             {"player": "#", "tile": <tile coordinates>}
  RP   Resource Production     { "resources": <resource notation> }
  RR   Robber rob              { "player":"#", "resources": <resource notation> }
  RS   Round Start             {"round": #}
  TA   Trade accept            {"player": "#", "uuid":"#"}
  TB   Trade bank              {"player": "#", "resources":<resource notation>}
  TC   Trade cancel            {"player": "#", "uuid":"#"}
  TE   Turn End                {"player": "#"}
  TO   Trade offer             {"player": "#", "uuid":"#", "resources":<resource notation>}
  TR   Trade resources         {"player": "#", "uuid":"#", "resources":<resource notation>}
  TS   Turn Start              {"player": "#"}
  YP   Year of plenty          {"player": "#", "resources":<resource notation>}

=head2 Trading

Trading is a big part of Settlers. Players may trade with each other or with the Bank. 

Bank trades are described using the trade bank event. For example:

  "TB":{"player":"2", "resources":{"bank":{"B":"-1","O":"4"},"2":{"B":"1","O":"-4"}}

Player trades have two parts: offer and acceptance. A Player may offer a trade to other players with resource notation and a universal unique id (uuid).

The trade offer can be ended with:

=over 4

=item * Trade cancel

The offering player cancels the offer using the trade cancel event.

=item * Trade accept

The other player accepts the trade offer using the trade accept event.

=item * End turn

If a player's turn ends, all outstanding trade offers are cancelled.

=back

Here is an example trade between player 1 and player 2:

  "TO":{"player":"1", "resources":{{"B":-2,"W":1},"2":{"B":2,"W":-1}}, "uuid":"1234-56789-01234"},
  "TA":{"player":"2", "uuid":"1234-56789-01234"},
  "TR":{"resources":{"1":{"B":-2,"W":1},"3":{"B":2,"W":-1}}},

The exchange begins with a Trade offer from player 1 for 1 wool in exchange for 2 brick to player 2. Player 2 accepts the offer, and this triggers the Trade resources event.

=head2 Chat

Player chat uses the event code C<CH>. It provides a key/pair of the player name and the chat text. Here's a conversation:

  "CH": {"player":"1", "msg"::"Let's do this!"},
  "CH": {"player":"2", "msg"::"You're going to lose again"},

Chat is not necessary for game notation, but may help with the implementation of a game server using game notation. Server or referee chat messages have the player id C<A> for admin.

=head2 Phases

See the file F<example.json> for an example of SGN notation covering all phases of the game.

=over 4

=item 1 Setup

Setup involves adding players and defining the map.

=item 2 Deployment

Players can deploy settlements and roads in the deployment phase according to the rules of Settlers. Player 1 always goes first.

=item 3 Play

This is the regular Settlers play action.

=item 4 End

The game is over as a player has won.

=back

=head2 Rounds

A round is one cycle of every player's turn. The Deployment phase has 2 rounds and the Play phase has as many rounds as required to end the game.

=head2 Turns

During the Deployment phase, a player must build a settlement and a road, then their turn ends. No other actions during Deployment are permitted. Player 1 always goes first, then player 2, and so on. When the last player has completed their first Deployment phase turn, the turn sequence then reverses so that the last player immediately gets another Deployment phase turn. Deployment is over when the first player has deployed two settlements and two roads.

During the Play phase, the turn sequence begins with Player 1. They may play a development card. The next action they must take is to roll the dice. After the dice roll has been resolved, they may offer and received trade offers from other players and they can build assets. Once player 1 ends their turn, player 2 will have the next turn and so on.

=head1 FAQ

=over 4

=item * I<Is SGN case-sensitive?> YES!

=item * I<Why is there no Road Building event?> There is no need for it. When the Play Development card event occurs with a type of C<RB> that indicates road building is active. The player can then build roads using the build road event.

=back

=head2 See Also

L<Settlers-Game|https://github.com/dnmfarrell/Settlers-Game> is my attempt to implement a Settlers game class using SGN.

L<Pioneers|http://pio.sourceforge.net/> an open source implementation of the island colonization game.

L<Catan|http://playcatan.com> the official website for Settlers of Catan.

=head2 Version

0.02

=head2 Changes

=head3 0.02 2015-11-25

Ports are declared on paths instead of tiles. SGN messages have event type, value, sender and UUID attributes.

=head3 0.01 2015-11-20

Initial release

=head2 Author

David Farrell, E<copy> 2015.

=head2 License

FreeBSD, see LICENSE

=cut
