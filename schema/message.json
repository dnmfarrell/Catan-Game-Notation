{
  "id": "https://github.com/dnmfarrell/Settlers-Game-Notation/schema/message.json",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "definitions": {
    "tCode": {
      "type": "string",
      "enum": ["D", "F", "FO", "H", "M", "P", "S"]
    },
    "rNumber": {
      "type": ["integer", "null"],
      "minimum": 2,
      "maximum": 12
    },
    "tile": {
      "type": "array",
      "minSize": 2,
      "maxSize": 2,
      "items": {
        "type": "integer"
      }
    },
    "intersection": {
      "type": "array",
      "minSize": 3,
      "maxSize": 3,
      "items": {
        "$ref": "#/definitions/tile"
      }
    },
    "path": {
      "type": "array",
      "minSize": 2,
      "maxSize": 2,
      "items": {
        "$ref": "#/definitions/intersection"
      }
    },
    "hCode": {
      "type": "string",
      "enum": ["HR", "HRB", "HRG", "HRL", "HRO", "HRW"]
    },
    "tiles": {
      "type": "array",
      "minSize": 37,
      "items": {
        "type": "object",
        "allOf": [{
          "$ref": "#/definitions/tile"
        }, {
          "$ref": "#/definitions/tile"
        }, {
          "$ref": "#/definitions/tile"
        }]
      }
    },
    "harbors": {
      "type": "array",
      "minSize": 8,
      "items": {
        "type": "object",
        "allOf": [{
          "$ref": "#/definitions/path"
        }, {
          "$ref": "#/definitions/hCode"
        }]
      }
    },
    "resources": {
      "type": "object",
      "properties": {
        "player": {
          "type": "string"
        },
        "B": {
          "type": "integer"
        },
        "G": {
          "type": "integer"
        },
        "L": {
          "type": "integer"
        },
        "O": {
          "type": "integer"
        },
        "W": {
          "type": "integer"
        }
      }
    },
    "cCode": {
      "type": "string",
      "enum": ["KN", "MO", "RB", "VP", "YP"]
    },
    "phase": {
      "type": "string",
      "enum": ["Setup", "Deployment", "Play", "End"]
    },
    "message": {
      "type": "object",
      "properties": {
        "uuid": {
          "type": "string"
        },
        "player": {
          "type": "string"
        },
        "batch": {
          "type": "array",
          "minSize": 2,
          "maxSize": 2,
          "items": {
            "type": "number"
          }
        },
        "required": ["uuid", "player"]
      }
    }
  },
  "type": "object",
  "allOf": [{
    "$ref": "#/definitions/message"},
    {"oneOf": [{
      "properties": {
        "event": { "pattern": "^BC$" },
        "value": {
          "$ref": "#/definitions/intersection"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^BD$" },
        "value": {
          "$ref": "#/definitions/cCode"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^BR$" },
        "value": {
          "$ref": "#/definitions/intersection"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^BS$" },
        "value": {
          "$ref": "#/definitions/intersection"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^CH$" },
        "value": {
          "properties": {
            "msg": {
              "type": "string"
            }
          },
          "required": ["msg"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^CR$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^DR$" },
        "value": {
          "properties": {
            "result": {
              "type": "integer"
            }
          },
          "required": ["result"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^GO$" },
        "value": {}
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^LA$" },
        "value": {
          "properties": {
            "strength": {
              "type": "integer"
            }
          },
          "required": ["strength"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^LR$" },
        "value": {
          "properties": {
            "length": {
              "type": "integer"
            }
          },
          "required": ["length"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^MD$" },
        "value": {
          "$ref": "#/definitions/tiles",
          "$ref": "#/definitions/harbors"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^MO$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^PA$" },
        "value": {
          "properties": {
            "player": {
              "type": "string"
            }
          },
          "required": ["player"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^PD$" },
        "value": {
          "$ref": "#/definitions/cCode"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^PE$" },
        "value": {
          "$ref": "#/definitions/phase"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^PS$" },
        "value": {
          "$ref": "#/definitions/phase"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RA$" },
        "value": {}
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RD$" },
        "value": {}
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RE$" },
        "value": {
          "properties": {
            "round": {
              "type": "integer"
            }
          },
          "required": ["round"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RS$" },
        "value": {
          "properties": {
            "round": {
              "type": "integer"
            }
          },
          "required": ["round"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RM$" },
        "value": {
          "$ref": "#/definitions/tile"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RP$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^RR$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TA$" },
        "value": {
          "properties": {
            "uuid": {
              "type": "string"
            }
          },
          "required": ["round"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TD$" },
        "value": {
          "properties": {
            "uuid": {
              "type": "string"
            }
          },
          "required": ["round"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TC$" },
        "value": {
          "properties": {
            "uuid": {
              "type": "string"
            }
          },
          "required": ["round"]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TB$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TO$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TE$" },
        "value": {}
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TS$" },
        "value": {}
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^TR$" },
        "value": {
          "allOf": [{
            "$ref": "#/definitions/resources"
          }, {
            "properties": {
              "uuid": {
                "type": "string"
              }
            },
            "required": ["uuid"]
          }]
        }
      },
      "required": ["event", "value"]
    }, {
      "properties": {
        "event": { "pattern": "^YP$" },
        "value": {
          "$ref": "#/definitions/resources"
        }
      },
      "required": ["event", "value"]
    }]}
  ]
}
